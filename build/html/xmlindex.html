
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>XML Indexing &#8212; Vufind Documentation 0.0.1 documentation</title>
    <link rel="stylesheet" href="_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/language_data.js"></script>
    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Web crawling with Vufind" href="webcrawl.html" />
    <link rel="prev" title="Working with XML and HTML" href="vufind_harvest.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="webcrawl.html" title="Web crawling with Vufind"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="vufind_harvest.html" title="Working with XML and HTML"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">Vufind Documentation 0.0.1 documentation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">XML Indexing</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="xml-indexing">
<h1>XML Indexing<a class="headerlink" href="#xml-indexing" title="Permalink to this headline">¶</a></h1>
<div class="section" id="chapter-11-xml-indexing">
<h2>Chapter 11. XML Indexing<a class="headerlink" href="#chapter-11-xml-indexing" title="Permalink to this headline">¶</a></h2>
<div class="section" id="learning-objectives">
<h3>Learning Objectives<a class="headerlink" href="#learning-objectives" title="Permalink to this headline">¶</a></h3>
<p>After reading this chapter, you will understand:</p>
<ul class="simple">
<li><p>The purpose of XSLT.</p></li>
<li><p>How to extend XSLT with custom functions.</p></li>
<li><p>How to use XSLT to index XML records.</p></li>
<li><p>How to import batches of records harvested with OAI-PMH.</p></li>
</ul>
</div>
<div class="section" id="understanding-xslt">
<h3>11.1. Understanding XSLT<a class="headerlink" href="#understanding-xslt" title="Permalink to this headline">¶</a></h3>
<p>XSLT stands for “eXtensible Stylesheet Language Transformations.” It is a declarative programming language used for defining rules to transform one XML document into a different XML document. An XSLT “program” is actually itself an XML document containing rules for selecting elements from a source document and using them to construct a target document. Since many metadata formats are represented using XML formats, and since Solr uses an XML-based format for updating its index, XSLT serves as a useful tool for indexing metadata into VuFind’s Solr index.</p>
<p>Several versions of the XSLT standard have been developed over the years, with version 3.0 being the most recent as of this writing. However, the PHP language only supports the original 1.0 version of XSLT; thus, by extension, VuFind also uses XSLT 1.0 for its built-in XML indexing tools. This is limiting in some ways, since later versions of XSLT added more richness to the language; however, most of these limitations can be overcome through one of XSLT’s most useful features: extensibility. The PHP XSLT interpreter allows you to register custom PHP functions so that they can be called from within an XSLT sheet. Thus, if a capability is missing from XSLT itself, you can overcome the limitation by delegating to custom PHP code.</p>
<p>Writing your own XSLT sheets and custom PHP functions is beyond the scope of this book; fortunately, for many common systems, you will not have to, since VuFind provides sample indexing configurations for several popular systems (and many of these examples can be adjusted to suit other systems with only minor changes). With an understanding of VuFind’s command line tools and even a rudimentary understanding of how XSLT works, you should be able to accomplish quite a lot.</p>
<p>If you want to gain a deeper understanding of the XSLT language, numerous helpful books and online articles exist. Just be sure to check which version of the standard is being discussed, since articles about XSLT 2.0 and newer may include some information that will not apply to VuFind’s basic XSLT 1.0 interpreter. Doug Tidwell’s XSLT, published by O’Reilly, is a thorough guidebook and reference; the first edition of the book (published in 2001) covers XSLT 1.0, while the second edition (published in 2009) discusses both 1.0 and 2.0.</p>
</div>
<div class="section" id="vufinds-command-line-xslt-indexer">
<h3>11.2 VuFind’s Command-Line XSLT Indexer<a class="headerlink" href="#vufinds-command-line-xslt-indexer" title="Permalink to this headline">¶</a></h3>
<p>VuFind’s XSLT indexing tool is found at $VUFIND_HOME/import/import-xsl.php. It can be run from the command line like this:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">php $VUFIND_HOME/import/import-xsl.php &lt;XML_file&gt; &lt;properties_file&gt;</span>
</pre></div>
</div>
<p>In this command, &lt;XML_file&gt; is the path to an XML file to index, and &lt;properties_file&gt; is the name of a indexing configuration file. For &lt;properties_file&gt;, you only need to specify a filename, not a full path; that filename will be searched for first in $VUFIND_LOCAL_DIR/import, and then in $VUFIND_HOME/import, allowing you to override configuration files through your local configuration directory following VuFind’s usual conventions.</p>
<p>The properties file specifies which XSLT sheet will be used to perform the transformation; example XSLTs are found in $VUFIND_HOME/import/xsl and can be overridden in the equivalent $VUFIND_LOCAL_DIR subdirectory as needed. The file also specifies which custom PHP functions will be made accessible to the XSLT code, and sets up parameters (like your institution name) that will be passed along to the XSLT. All of the example properties files found in $VUFIND_HOME/import contain detailed comments explaining the various settings; you should look at one of these to find the latest up-to-date information on available options.</p>
<p>The import-xsl.php command accepts an optional –test-only switch, which puts it into test mode. In test mode, the result of the XSLT transformation is displayed on screen, and no data is sent to Solr. This is extremely useful for troubleshooting, testing and developing XSLT without potentially loading bad data into your index. For example, if you wanted to see what would happen if you applied the default OJS transformations to an XML record found in $VUFIND_LOCAL_DIR/harvest/ojs/record1.xml, you could run this command:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">php $VUFIND_HOME/import/import-xsl.php --test-only $VUFIND_LOCAL_DIR/harvest/ojs/record1.xml ojs.properties</span>
</pre></div>
</div>
<p>The result might look something like this:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span>
<span class="go"> &lt;add xmlns:oai_dc=&quot;http://www.openarchives.org/OAI/2.0/oai_dc/&quot; xmlns:dc=&quot;http://purl.org/dc/elements/1.1/&quot; xmlns:php=&quot;http://php.net/xsl&quot; xmlns:xlink=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;&gt;</span>
<span class="go">  &lt;doc&gt;</span>
<span class="go">  &lt;field name=&quot;id&quot;/&gt;</span>
<span class="go">  &lt;field name=&quot;record_format&quot;&gt;ojs&lt;/field&gt;</span>
<span class="go">  &lt;field name=&quot;allfields&quot;&gt;The Useful Uselessness of the Humanities Roochnik, David Villanova University 2008-01-01 application/pdf http://expositions.journals.villanova.edu/article/view/82 Expositions; Vol 2, No 1 (2008); 19-26 North America Contemporary Authors who publish with this journal agree to the following terms:Authors retain copyright and grant the journal right of first publication with the work simultaneously licensed under a Creative Commons Attribution License that allows others to share the work with an acknowledgement of the work&#39;s authorship and initial publication in this journal.Authors are able to enter into separate, additional contractual arrangements for the non-exclusive distribution of the journal&#39;s published version of the work (e.g., post it to an institutional repository or publish it in a book), with an acknowledgement of its initial publication in this journal.Authors are permitted and encouraged to post their work online (e.g., in institutional repositories or on their website) prior to and during the submission process, as it can lead to productive exchanges, as well as earlier and greater citation of published work (See The Effect of Open Access).&lt;/field&gt;</span>
<span class="go">  &lt;field name=&quot;institution&quot;&gt;My University&lt;/field&gt;</span>
<span class="go">  &lt;field name=&quot;collection&quot;&gt;OJS&lt;/field&gt;</span>
<span class="go">  &lt;field name=&quot;format&quot;&gt;Online&lt;/field&gt;</span>
<span class="go">  &lt;field name=&quot;author&quot;&gt;Roochnik, David&lt;/field&gt;</span>
<span class="go">  &lt;field name=&quot;author_sort&quot;&gt;Roochnik, David&lt;/field&gt;</span>
<span class="go">  &lt;field name=&quot;title&quot;&gt;The Useful Uselessness of the Humanities&lt;/field&gt;</span>
<span class="go">  &lt;field name=&quot;title_short&quot;&gt;The Useful Uselessness of the Humanities&lt;/field&gt;</span>
<span class="go">  &lt;field name=&quot;title_full&quot;&gt;The Useful Uselessness of the Humanities&lt;/field&gt;</span>
<span class="go">  &lt;field name=&quot;title_sort&quot;&gt;useful uselessness of the humanities&lt;/field&gt;</span>
<span class="go">  &lt;field name=&quot;description&quot;&gt; &lt;/field&gt;</span>
<span class="go">  &lt;field name=&quot;publisher&quot;&gt;Villanova University&lt;/field&gt;</span>
<span class="go">  &lt;field name=&quot;publishDate&quot;&gt;2008&lt;/field&gt;</span>
<span class="go">  &lt;field name=&quot;publishDateSort&quot;&gt;2008&lt;/field&gt;</span>
<span class="go">  &lt;field name=&quot;url&quot;&gt;http://expositions.journals.villanova.edu/article/view/82&lt;/field&gt;</span>
<span class="go"> &lt;/doc&gt;</span>
<span class="go"> &lt;/add&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="batch-loading-xml">
<h3>11.3 Batch-Loading XML<a class="headerlink" href="#batch-loading-xml" title="Permalink to this headline">¶</a></h3>
<p>While indexing a single record is useful (especially when developing and testing a new set of import rules), it is much more common to want to ingest a batch of records all at once (such as after performing an OAI-PMH harvest as discussed in the previous chapter). Fortunately, VuFind includes a script to automatically ingest all of the XML files in a directory. It is used like this:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span>VUFIND_HOME/harvest/batch-import-xsl.sh &lt;harvest_subdirectory&gt; &lt;properties_file&gt;
</pre></div>
</div>
<p>The &lt;harvest_subdirectory&gt; parameter is the name of a directory found under either $VUFIND_LOCAL_DIR/harvest or $VUFIND_HOME/harvest (following the usual VuFind pattern of checking the local directory first). The &lt;properties_file&gt; parameter specifies a configuration filename, exactly as described for the single-file importer in section 11.2.</p>
<p>When you run the script, it will create a “processed” subdirectory under &lt;harvest_subdirectory&gt;. It will index XML files from &lt;harvest_subdirectory&gt; one at a time, moving them into the “processed” subdirectory when they are successfully imported. Any files that fail to load correctly will not be moved, so you can troubleshoot them at the end of the process. If you ever want to re-index your records, you can simply move the files back out of the processed folder and into the main &lt;harvest_subdirectory&gt;.</p>
<p>If you performed an OAI-PMH harvest, you may also have a number of files in your harvest directory with names ending in “.delete,” tracking records that have been deleted from the source repository. There is a $VUFIND_HOME/harvest/batch-delete.sh script which will take care of removing these deleted records from your Solr index; it takes a single &lt;harvest_subdirectory&gt; parameter and behaves exactly the same as batch-import-xsl.sh in terms of moving files to the processed directory, etc.</p>
</div>
<div class="section" id="additional-resources">
<h3>Additional Resources<a class="headerlink" href="#additional-resources" title="Permalink to this headline">¶</a></h3>
<p>The XSLT 1.0 standard used by VuFind can be found at <a class="reference external" href="https://www.w3.org/TR/xslt-10/">https://www.w3.org/TR/xslt-10/</a>. VuFind’s wiki page discussing XML indexing can be found at <a class="reference external" href="https://vufind.org/wiki/indexing:xml">https://vufind.org/wiki/indexing:xml</a>.</p>
</div>
<div class="section" id="summary">
<h3>Summary<a class="headerlink" href="#summary" title="Permalink to this headline">¶</a></h3>
</div>
<div class="section" id="review-questions">
<h3>Review Questions<a class="headerlink" href="#review-questions" title="Permalink to this headline">¶</a></h3>
<ol class="arabic simple">
<li><p>What is XSLT and how does VuFind use it?</p></li>
<li><p>How can you see the result of a record’s XSLT transformation without actually indexing that record into Solr?</p></li>
<li><p>What command is used for batch-loading harvested XML records, and what parameters does it need?</p></li>
</ol>
</div>
</div>
</div>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">XML Indexing</a><ul>
<li><a class="reference internal" href="#chapter-11-xml-indexing">Chapter 11. XML Indexing</a><ul>
<li><a class="reference internal" href="#learning-objectives">Learning Objectives</a></li>
<li><a class="reference internal" href="#understanding-xslt">11.1. Understanding XSLT</a></li>
<li><a class="reference internal" href="#vufinds-command-line-xslt-indexer">11.2 VuFind’s Command-Line XSLT Indexer</a></li>
<li><a class="reference internal" href="#batch-loading-xml">11.3 Batch-Loading XML</a></li>
<li><a class="reference internal" href="#additional-resources">Additional Resources</a></li>
<li><a class="reference internal" href="#summary">Summary</a></li>
<li><a class="reference internal" href="#review-questions">Review Questions</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="vufind_harvest.html"
                        title="previous chapter">Working with XML and HTML</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="webcrawl.html"
                        title="next chapter">Web crawling with Vufind</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/xmlindex.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="webcrawl.html" title="Web crawling with Vufind"
             >next</a> |</li>
        <li class="right" >
          <a href="vufind_harvest.html" title="Working with XML and HTML"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">Vufind Documentation 0.0.1 documentation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">XML Indexing</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2020, Demian Katz .
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 3.2.1.
    </div>
  </body>
</html>