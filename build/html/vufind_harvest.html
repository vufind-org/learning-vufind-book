
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Part 4. Working with XML and HTML &#8212; Vufind Documentation 0.0.1 documentation</title>
    <link rel="stylesheet" href="_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/language_data.js"></script>
    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Part 4. Working with XML and HTML" href="xmlindex.html" />
    <link rel="prev" title="Part 3. Styling and Theming" href="vufindcustom.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="xmlindex.html" title="Part 4. Working with XML and HTML"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="vufindcustom.html" title="Part 3. Styling and Theming"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">Vufind Documentation 0.0.1 documentation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Part 4. Working with XML and HTML</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="part-4-working-with-xml-and-html">
<h1>Part 4. Working with XML and HTML<a class="headerlink" href="#part-4-working-with-xml-and-html" title="Permalink to this headline">¶</a></h1>
<div class="section" id="chapter-10-content-harvesting">
<h2>Chapter 10. Content Harvesting<a class="headerlink" href="#chapter-10-content-harvesting" title="Permalink to this headline">¶</a></h2>
<div class="section" id="learning-objectives">
<h3>Learning Objectives<a class="headerlink" href="#learning-objectives" title="Permalink to this headline">¶</a></h3>
<p>After reading this chapter, you will understand:</p>
<ul class="simple">
<li><p>How VuFind uses the OAI-PMH protocol.</p></li>
<li><p>How to load XML-based data into VuFind’s index using XSLT.</p></li>
</ul>
</div>
<div class="section" id="understanding-oai-pmh">
<h3>10.1 Understanding OAI-PMH<a class="headerlink" href="#understanding-oai-pmh" title="Permalink to this headline">¶</a></h3>
<p>OAI-PMH stands for the Open Archives Initiative Protocol for Metadata Harvesting. It provides a relatively simple set of rules for exchanging metadata between computer systems using XML documents. The standard was developed in the early 2000’s, with the current version of the protocol (2.0) being finalized in 2002. While it shows its age in some ways (such as its exclusive reliance on XML formats), it is widely adopted and supported, making it a very useful tool for obtaining records to index into VuFind.</p>
<p>At its most basic, OAI-PMH allows a client machine to download all of the metadata records from a server machine. In addition to supporting harvesting of full collections, OAI-PMH also allows a client to harvest records incrementally, receiving a collection of records that have been added, deleted or changed since a particular date. Other features include the ability to request specific subsets of a collection (which are defined by the server providing the records – the protocol sets no guidelines for how sets are determined) and the ability to retrieve records in multiple formats (though only Dublin Core, the favored “least common denominator” XML metadata standard, is guaranteed to be universally supported).</p>
<p>VuFind includes tools for harvesting and indexing records from an OAI-PMH server. It also includes built-in functionality that allows it to act as an OAI-PMH server if you wish to provide your records to others. This chapter discusses VuFind’s harvesting and server support in more detail; chapter 11 will talk about what to do with harvested records once you have them.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="go">&lt;OAI-PMH xmlns=&quot;http://www.openarchives.org/OAI/2.0/&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xsi:schemaLocation=&quot;http://www.openarchives.org/OAI/2.0/ http://www.openarchives.org/OAI/2.0/OAI-PMH.xsd&quot;&gt;</span>
<span class="go">  &lt;responseDate&gt;2020-03-25T14:46:53Z&lt;/responseDate&gt;</span>
<span class="go">  &lt;request verb=&quot;ListMetadataFormats&quot;&gt;http://www.doaj.org/oai.article&lt;/request&gt;</span>
<span class="go">  &lt;ListMetadataFormats&gt;</span>
<span class="go">     &lt;metadataFormat&gt;</span>
<span class="go">        &lt;metadataPrefix&gt;oai_dc&lt;/metadataPrefix&gt;</span>
<span class="go">        &lt;schema&gt;http://www.openarchives.org/OAI/2.0/oai_dc.xsd&lt;/schema&gt;</span>
<span class="go">        &lt;metadataNamespace&gt;http://www.openarchives.org/OAI/2.0/oai_dc/&lt;/metadataNamespace&gt;</span>
<span class="go">     &lt;/metadataFormat&gt;</span>
<span class="go">     &lt;metadataFormat&gt;</span>
<span class="go">        &lt;metadataPrefix&gt;oai_doaj&lt;/metadataPrefix&gt;</span>
<span class="go">        &lt;schema&gt;https://doaj.org/static/doaj/doajArticles.xsd&lt;/schema&gt;</span>
<span class="go">        &lt;metadataNamespace&gt;https://doaj.org/features/oai_doaj/1.0/&lt;/metadataNamespace&gt;</span>
<span class="go">     &lt;/metadataFormat&gt;</span>
<span class="go">  &lt;/ListMetadataFormats&gt;</span>
<span class="go">&lt;/OAI-PMH&gt;</span>
</pre></div>
</div>
<p>As you can see, this reveals support for not just the standard oai_dc format, but also for a locally-defined metadata format called oai_doaj.</p>
<p>uFind includes examples for a variety of common formats, but if you harvest a brand new metadata format, you will also be responsible for defining rules for indexing it into VuFind; this is discussed further in chapter 11.</p>
<div class="section" id="working-with-identifiers">
<h4>10.2.4 Working with Identifiers<a class="headerlink" href="#working-with-identifiers" title="Permalink to this headline">¶</a></h4>
<p>As discussed in section 3.5.2, it is very important for every record to have its own unique identifier; without IDs, we can’t index things into Solr in a useful way. Some of the metadata formats provided by OAI-PMH servers – especially the richer ones like MARC – will already contain useful identifiers. However, it is fairly common that records will not contain unique identifiers, or that they will contain multiple identifiers that are not easily differentiated from one another.</p>
<p>VuFind includes examples for a variety of common formats, but if you harvest a brand new metadata format, you will also be responsible for defining rules for indexing it into VuFind; this is discussed further in chapter 11.</p>
</div>
<div class="section" id="id1">
<h4>10.2.4 Working with Identifiers<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h4>
<p>As discussed in section 3.5.2, it is very important for every record to have its own unique identifier; without IDs, we can’t index things into Solr in a useful way. Some of the metadata formats provided by OAI-PMH servers – especially the richer ones like MARC – will already contain useful identifiers. However, it is fairly common that records will not contain unique identifiers, or that they will contain multiple identifiers that are not easily differentiated from one another.</p>
<p>Fortunately, VuFind’s OAI-PMH harvester provides a simple solution to this problem. When the OAI-PMH protocol provides records, it sends not just the raw metadata, but also a header above the metadata that includes additional information. This header always includes a unique ID for every record. The harvester only saves the metadata itself, not the header, but several configuration options exist for injecting values from the header into the metadata as custom XML tags.</p>
<p>If you add “injectId = identifier” to your oai.ini configuration section, then unique IDs from the header will be added to an &lt;identifier&gt; tag inside the top-level tag of your harvested metadata records. The “identifier” tag is used by all of VuFind’s example indexing configurations, but if you wish to use a different tag name for some reason, you can just specify a different value in the configuration.</p>
<p>It is also worth noting that most OAI-PMH record identifiers are quite verbose – for example, “oai:doaj.org/article:311ce1ec3dea42d2a7db0c3de149d865.” It may be desirable to shorten them and/or remove certain characters in order to improve the readability of URLs and avoid other problems (for example, some web servers may require configuration adjustments to support identifiers containing slash characters). Fortunately, there are oai.ini settings to address this situation as well: the idSearch[] and idReplace[] settings can be used in combination with injectId to perform regular expression replacements on IDs before injecting them into metadata. Regular expressions are also briefly discussed in section 5.3.6; they provide a standard language for matching patterns in text, and can be very useful for transformations like this.</p>
<p>If we wanted to replace the “oai:doaj.org/” prefix with a more concise “<a href="#id2"><span class="problematic" id="id3">doaj_</span></a>” prefix, we could revise our example configuration from earlier to:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">[doaj]</span>
<span class="go">url = http://www.doaj.org/oai.article</span>
<span class="go">metadataPrefix = oai_dc</span>
<span class="go">injectId = identifier</span>
<span class="go">idSearch[] = &quot;|oai:doaj.org/|&quot;</span>
<span class="go">idReplace[] = &quot;doaj_&quot;</span>
</pre></div>
</div>
<p>…and the desired ID transformation will take place when the records are harvested.</p>
<p>If you need to make multiple adjustments to IDs, or if you need to account for several different possible patterns, you can repeat the idSearch[] and idReplace[] lines to create a series of rules that will be applied sequentially to every record ID.</p>
</div>
<div class="section" id="grouping-records-together">
<h4>10.2.5 Grouping Records Together<a class="headerlink" href="#grouping-records-together" title="Permalink to this headline">¶</a></h4>
<p>The default behavior of the harvest tool is to create a separate XML file on disk for each metadata file harvested. This keeps things simple, and it can be useful since it makes it easier to isolate problem records (if an import fails, there is no question about which record in a given file caused the problem). However, when loading records, it can slow down the process, since the indexing tools you are using will have to reinitialize themselves for each record.</p>
<p>The harvest tool provides configuration settings that allow you to group records together into fewer files. If you add “combineRecords = true” to your oai.ini section, each page of records loaded from the server will be stored in a single file, wrapped up inside a &lt;collection&gt; tag. If you want to change the name of the wrapping tag, you can use the combineRecordsTag setting to specify a different tag name.</p>
<p>The combineRecords functionality is ideal for harvesting MARC records; the SolrMarc import tool already knows how to deal with &lt;collection&gt; tags in MARC-XML, and it will load the files correctly. If you are working with other types of XML, it may be necessary to modify some of VuFind’s provided example import rules to account for multiple records per file; many of them were designed to assume they would only receive one record at a time, though this may be made more flexible in the future.</p>
</div>
<div class="section" id="troubleshooting">
<h4>10.2.6 Troubleshooting<a class="headerlink" href="#troubleshooting" title="Permalink to this headline">¶</a></h4>
<p>The harvest tool is designed to be able to resume after a problem, so if there is a network connectivity interruption or remote server outage, if you repeat the harvest command, it will attempt to resume from the last place where it left off.</p>
<p>A common problem with harvesting has to do with invalid data on the remote server. It is a fairly common situation that OAI-PMH servers do not fully validate the XML that they are generating, and sometimes they include incorrectly formatted or illegal characters that cause validation errors for the client.</p>
<p>VuFind’s harvest tool contains some settings that can help resolve persistent problems related to XML validation. If you add “sanitize = true” to your oai.ini section, VuFind will automatically strip out illegal characters. If you set the badXMLLog setting to a filename, VuFind will store more detailed information about problematic XML in this file, which may be helpful for troubleshooting the issue with the content provider. Finally, the sanitizeRegex[] is a repeatable setting which can be used to provide regular expressions defining characters and patterns to remove from incoming XML. This can usually be left at its default value, but if you run into special situations, this provides the ability to customize the cleanup logic.</p>
</div>
<div class="section" id="the-stand-alone-harvest-tool">
<h4>10.2.7 The Stand-Alone Harvest Tool<a class="headerlink" href="#the-stand-alone-harvest-tool" title="Permalink to this headline">¶</a></h4>
<p>VuFind’s OAI-PMH harvest tool is also available as a separate project; if you ever need to perform a metadata harvest but do not need the full weight of VuFind, it may be useful to download the separate tool, which is available at <a class="reference external" href="https://github.com/vufind-org/vufindharvest">https://github.com/vufind-org/vufindharvest</a>. The only differences between the stand-alone version and the version found in VuFind are the name of the directory containing the executable PHP code (bin instead of harvest) and the fact that the stand-alone tool does not automatically look for an oai.ini file, since it has no concept of $VUFIND_HOME or $VUFIND_LOCAL_DIR. Instead, you need to use the “–ini=filename.ini” command-line switch to specify your configuration file.</p>
</div>
</div>
<div class="section" id="open-source-oai-pmh-servers">
<h3>10.3 Open Source OAI-PMH Servers<a class="headerlink" href="#open-source-oai-pmh-servers" title="Permalink to this headline">¶</a></h3>
<p>Many commonly-used open source tools (including DSpace, Greenstone, Koha and OJS, the Open Journal System) include OAI-PMH server capabilities, as do many public repositories of shared open data (such as the Directory of Open Access Journals, DOAJ). VuFind includes sample configurations for harvesting the most popular of these tools, and those configurations can often be easily adapted to support others. This makes VuFind an ideal tool for creating the search “glue” between an ecosystem of open tools.</p>
<div class="section" id="dspace">
<h4>10.3.1 DSpace<a class="headerlink" href="#dspace" title="Permalink to this headline">¶</a></h4>
<p>The DSpace repository software contains an OAI-PMH server that can be enabled (see the DSpace documentation at <a class="reference external" href="https://wiki.lyrasis.org/display/DSDOC6x/OAI">https://wiki.lyrasis.org/display/DSDOC6x/OAI</a> for details). Several metadata formats are supported, and VuFind includes built-in example configurations for indexing both the simple oai_dc metadata as well as the richer DIM format.</p>
</div>
<div class="section" id="koha">
<h4>10.3.2 Koha<a class="headerlink" href="#koha" title="Permalink to this headline">¶</a></h4>
<p>The open source Koha Integrated Library System provides a built-in OAI-PMH service, which can be turned on with a configuration setting (see the Koha manual at <a class="reference external" href="https://koha-community.org/manual/18.05/en/html/webservices.html#oai-pmh">https://koha-community.org/manual/18.05/en/html/webservices.html#oai-pmh</a> for details). Once activated, you can point VuFind’s harvester at Koha using the marcxml metadataPrefix in order to retrieve records suitable for indexing with SolrMarc as described in chapter 3. Note that you can batch-load harvested MARC records using the harvest/batch-import-marc.sh script, which behaves very similarly to the harvest/batch-import-xsl.sh script described in section 11.3 below. Your import process will run more quickly if you harvest in groups as described in section 10.2.5.</p>
</div>
<div class="section" id="ojs">
<h4>10.3.3. OJS<a class="headerlink" href="#ojs" title="Permalink to this headline">¶</a></h4>
<p>The OJS (Open Journal System) publishing platform includes built-in OAI-PMH support as well as a metadata plugin system which makes it possible to add support for custom metadata formats. VuFind includes sample import rules for both the Dublin Core and NLM (National Library of Medicine) formats.</p>
</div>
<div class="section" id="vufinds-oai-pmh-server">
<h4>10.4 VuFind’s OAI-PMH Server<a class="headerlink" href="#vufinds-oai-pmh-server" title="Permalink to this headline">¶</a></h4>
<p>In addition to consuming OAI-PMH records, VuFind can also produce them. While VuFind’s OAI-PMH server is turned off by default, it can be activated by uncommenting and filling in the [OAI] section of config.ini. All of the available settings are described by comments in the .ini file; none are required (simply uncommenting the [OAI] section header is enough to turn on the server), but setting an identifier and repository_name are strongly recommended. Other settings exist to give you control over how your OAI-PMH server presents record sets and metadata formats.</p>
<p>Once set up, your OAI-PMH server base URL will be your VuFind URL with “/OAI/Server” appended; for example, Villanova University’s instance is <a class="reference external" href="https://library.villanova.edu/Find/OAI/Server">https://library.villanova.edu/Find/OAI/Server</a>. If you remove the “/Server” from the end of the page, you will be presented with a helpful form that you can use to test all of the standard OAI-PMH verbs.</p>
<p>It is very important to note that VuFind’s OAI-PMH server will only work correctly if you turn on some optional indexing features; these are discussed below.</p>
</div>
<div class="section" id="record-change-tracking">
<h4>10.4.1 Record Change Tracking<a class="headerlink" href="#record-change-tracking" title="Permalink to this headline">¶</a></h4>
<p>Because an OAI-PMH server needs to be able to provide incremental updates showing which records have been added, changed, or deleted, VuFind needs to store some additional information at index time in order to keep track of these details. This functionality is disabled by default, because it makes the indexing process slower; however, that cost is necessary to achieve the benefit of OAI-PMH server functionality (and also some other potentially useful behavior, like properly-sorted RSS feeds and the ability to filter search results by record age).</p>
<p>If you are only indexing MARC records, activating record change tracking is as simple as uncommenting the first_indexed and last_indexed lines in VuFind’s example marc_local.properties file (see section 3.4.3). If you are also indexing XML records, you will need to ensure that the records contain information about modification dates and that your import rules correctly populate the first_indexed and last_indexed fields in Solr.</p>
<p>For more information about record change tracking, see the relevant page in the VuFind wiki (<a class="reference external" href="https://vufind.org/wiki/indexing:tracking_record_changes">https://vufind.org/wiki/indexing:tracking_record_changes</a>).
(<a class="reference external" href="https://vufind.org/wiki/indexing:tracking_record_changes">https://vufind.org/wiki/indexing:tracking_record_changes</a>).</p>
</div>
</div>
<div class="section" id="additional-resources">
<h3>Additional Resources<a class="headerlink" href="#additional-resources" title="Permalink to this headline">¶</a></h3>
<p>You can read more about OAI-PMH at the protocol’s official website
(<a class="reference external" href="https://www.openarchives.org/pmh/">https://www.openarchives.org/pmh/</a>). VuFind’s OAI-PMH harvest tool has its own project page (<a class="reference external" href="https://github.com/vufind-org/vufindharvest">https://github.com/vufind-org/vufindharvest</a>). The VuFind wiki also contains notes on OAI-PMH harvesting (<a class="reference external" href="https://vufind.org/wiki/indexing:oai-pmh">https://vufind.org/wiki/indexing:oai-pmh</a>) and server functionality (<a class="reference external" href="https://vufind.org/wiki/indexing:tracking_record_changes#oai-pmh_server_functionality">https://vufind.org/wiki/indexing:tracking_record_changes#oai-pmh_server_functionality</a>).</p>
</div>
<div class="section" id="summary">
<h3>Summary<a class="headerlink" href="#summary" title="Permalink to this headline">¶</a></h3>
<p>The OAI-PMH protocol provides a common standard for sharing metadata. VuFind can take advantage of the protocol as both a consumer and a producer in order to pull together records from multiple systems and share its collection with others.</p>
</div>
<div class="section" id="review-questions">
<h3>Review Questions<a class="headerlink" href="#review-questions" title="Permalink to this headline">¶</a></h3>
<ol class="arabic simple">
<li><p>What are the most important features of the OAI-PMH protocol?</p></li>
<li><p>What are five commonly-used systems that provide OAI-PMH support?</p></li>
<li><p>What configuration settings are required to allow VuFind to work as an OAI-PMH server?</p></li>
</ol>
</div>
</div>
</div>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Part 4. Working with XML and HTML</a><ul>
<li><a class="reference internal" href="#chapter-10-content-harvesting">Chapter 10. Content Harvesting</a><ul>
<li><a class="reference internal" href="#learning-objectives">Learning Objectives</a></li>
<li><a class="reference internal" href="#understanding-oai-pmh">10.1 Understanding OAI-PMH</a><ul>
<li><a class="reference internal" href="#working-with-identifiers">10.2.4 Working with Identifiers</a></li>
<li><a class="reference internal" href="#id1">10.2.4 Working with Identifiers</a></li>
<li><a class="reference internal" href="#grouping-records-together">10.2.5 Grouping Records Together</a></li>
<li><a class="reference internal" href="#troubleshooting">10.2.6 Troubleshooting</a></li>
<li><a class="reference internal" href="#the-stand-alone-harvest-tool">10.2.7 The Stand-Alone Harvest Tool</a></li>
</ul>
</li>
<li><a class="reference internal" href="#open-source-oai-pmh-servers">10.3 Open Source OAI-PMH Servers</a><ul>
<li><a class="reference internal" href="#dspace">10.3.1 DSpace</a></li>
<li><a class="reference internal" href="#koha">10.3.2 Koha</a></li>
<li><a class="reference internal" href="#ojs">10.3.3. OJS</a></li>
<li><a class="reference internal" href="#vufinds-oai-pmh-server">10.4 VuFind’s OAI-PMH Server</a></li>
<li><a class="reference internal" href="#record-change-tracking">10.4.1 Record Change Tracking</a></li>
</ul>
</li>
<li><a class="reference internal" href="#additional-resources">Additional Resources</a></li>
<li><a class="reference internal" href="#summary">Summary</a></li>
<li><a class="reference internal" href="#review-questions">Review Questions</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="vufindcustom.html"
                        title="previous chapter">Part 3. Styling and Theming</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="xmlindex.html"
                        title="next chapter">Part 4. Working with XML and HTML</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/vufind_harvest.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="xmlindex.html" title="Part 4. Working with XML and HTML"
             >next</a> |</li>
        <li class="right" >
          <a href="vufindcustom.html" title="Part 3. Styling and Theming"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">Vufind Documentation 0.0.1 documentation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Part 4. Working with XML and HTML</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2020, Demian Katz .
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 3.2.1.
    </div>
  </body>
</html>