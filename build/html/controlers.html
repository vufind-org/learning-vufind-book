
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Controllers and actions &#8212; Vufind Documentation 0.0.1 documentation</title>
    <link rel="stylesheet" href="_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/language_data.js"></script>
    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Vufind Configuration options" href="conf_files.html" />
    <link rel="prev" title="Vufind plugins" href="vufindplugin.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="conf_files.html" title="Vufind Configuration options"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="vufindplugin.html" title="Vufind plugins"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">Vufind Documentation 0.0.1 documentation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Controllers and actions</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="controllers-and-actions">
<h1>Controllers and actions<a class="headerlink" href="#controllers-and-actions" title="Permalink to this headline">¶</a></h1>
<div class="section" id="chapter-18-controllers-and-actions">
<h2>Chapter 18. Controllers and Actions<a class="headerlink" href="#chapter-18-controllers-and-actions" title="Permalink to this headline">¶</a></h2>
<div class="section" id="learning-objectives">
<h3>Learning Objectives<a class="headerlink" href="#learning-objectives" title="Permalink to this headline">¶</a></h3>
<p>After reading this chapter, you will understand:</p>
<ul class="simple">
<li><p>The purpose of routes and controllers.</p></li>
<li><p>VuFind’s controller conventions.</p></li>
<li><p>How to add functionality to VuFind’s web interface.</p></li>
</ul>
<p>18.1 VuFind’s Controllers and Actions
As discussed in section 16.2, VuFind uses the laminas-mvc package to implement a model-view-controller architecture. Controllers are the part of the code that make things happen in VuFind.</p>
<p>When a user accesses one of VuFind’s URLs, the laminas-router system is triggered. The router component compares the text of the request URL against a set of rules configured in VuFind’s Laminas modules in order to figure out which piece of controller code to dispatch.</p>
<p>For example, if the user enters <a class="reference external" href="http://localhost/vufind/Example/Page">http://localhost/vufind/Example/Page</a>, they will most likely match VuFind’s default routing rule, defined in $VUFIND_HOME/module/VuFind/config/module.config.php:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">&#39;default&#39; =&gt; [</span>
<span class="go"> &#39;type&#39;    =&gt; &#39;Laminas\Router\Http\Segment&#39;,</span>
<span class="go"> &#39;options&#39; =&gt; [</span>
<span class="go">     &#39;route&#39;    =&gt; &#39;/[:controller[/[:action]]]&#39;,</span>
<span class="go">     &#39;constraints&#39; =&gt; [</span>
<span class="go">         &#39;controller&#39; =&gt; &#39;[a-zA-Z][a-zA-Z0-9_-]*&#39;,</span>
<span class="go">         &#39;action&#39;     =&gt; &#39;[a-zA-Z][a-zA-Z0-9_-]*&#39;,</span>
<span class="go">     ],</span>
<span class="go">     &#39;defaults&#39; =&gt; [</span>
<span class="go">         &#39;controller&#39; =&gt; &#39;index&#39;,</span>
<span class="go">         &#39;action&#39;     =&gt; &#39;Home&#39;,</span>
<span class="go">     ],</span>
<span class="go"> ],</span>
<span class="go">],</span>
</pre></div>
</div>
<p>This particular route uses a ‘type’ of ‘LaminasRouterHttpSegment’, which means that the route definition in ‘route’ can contain “segments” that start with colons (like :controller and :action), allowing parts of the user’s URL to be extracted and passed along to other parts of the code. Some of the route definition is enclosed in brackets, making it optional. Defaults are provided to give values to the segments in case the user omits them entirely – so with this route definition, accessing simply <a class="reference external" href="http://localhost/vufind">http://localhost/vufind</a> is effectively the same as accessing <a class="reference external" href="http://localhost/vufind/index/Home">http://localhost/vufind/index/Home</a>.</p>
<p>To learn about the Laminas router component in more detail, see the documentation at <a class="reference external" href="https://docs.laminas.dev/laminas-router/routing/">https://docs.laminas.dev/laminas-router/routing/</a>.</p>
<p>To continue the example of accessing the URL of <a class="reference external" href="http://localhost/vufind/Example/Page">http://localhost/vufind/Example/Page</a>, the default route defined above would extract a ‘controller’ value of ‘Example’ and an ‘action’ value of ‘Page’. These route values have special meanings when used in the laminas-mvc framework that VuFind is built on: they control which PHP code gets executed.</p>
<p>First, the controller value is used to look up a controller class in the controller plugin manager (see chapter 17 for more on plugin manages). By convention, VuFind’s controllers are set up with short names as aliases to make routing configuration more readable – thus, if VuFind had a VuFindControllerExampleController, it would also have an alias configuration allowing ‘Example’ to be used as a shorthand for retrieving the controller from the plugin manager.</p>
<p>If no matching controller can be found, VuFind will throw a 404 not found error… but if a controller exists, the action parameter from the route will be used to call a matching method on the controller. Controller actions must be named as an action name, followed by the word Action – so in the current example, VuFind would attempt to call the pageAction() method on the ExampleController.</p>
<p>Controller action methods most commonly return a LaminasViewModelViewModel object, which is a container that is used to pass data along to a view template for rendering. Most controller actions have corresponding view templates in the theme (for example, the pageAction of the ExampleController would expect to render a template named example/page.phtml). Any data elements that are inserted into the ViewModel object will be available to the view template as local variables that can be used for display.</p>
<p>In some special cases, controller actions may instead return a LaminasHttpResponse object representing a fully-formed HTTP response. This bypasses the usual view rendering behavior and can be useful in situations where special actions are needed (like a forced redirect to a different page) or where different types of content need to be returned (like when rendering an image, or providing a download of a binary file like a PDF).</p>
<p>Controllers are discussed in more detail in the Laminas documentation at <a class="reference external" href="https://docs.laminas.dev/laminas-mvc/controllers/">https://docs.laminas.dev/laminas-mvc/controllers/</a></p>
<p>Most of VuFind’s controllers extend the VuFindControllerAbstractBase class, which provides some helpful convenience methods for common VuFind-related activities. For example, there is a createViewModel() method which constructs a ViewModel object with some useful pre-populated values. In general, when adding new functionality to VuFind, it is useful to examine existing controllers and actions providing similar functionality, as there may be some patterns observed there that can be usefully emulated.</p>
</div>
<div class="section" id="example-adding-a-page-to-vufind">
<h3>18.2 Example: Adding a Page to VuFind<a class="headerlink" href="#example-adding-a-page-to-vufind" title="Permalink to this headline">¶</a></h3>
<p>The <a class="reference external" href="http://localhost/vufind/Example/Page">http://localhost/vufind/Example/Page</a> action from the previous section would lead to a 404 error in most VuFind instances, since that page is not defined as part of the core VuFind package. However, with the help of code generators, it would be easy to define such a page. Since controllers are just another plug-in (as described in chapter 17), some parts of the process should seem familiar by now. This section will show all of the steps involved.</p>
<p>For the purposes of this example, we will assume that you have a local code module called MyModule (see section 16.3.3 for more on local code modules) and a local theme called localtheme (see section 7.2 for more on theme generation). This example also assumes you are using VuFind 7.0 or later; earlier releases of VuFind did not support automatic generation of controllers, though of course the same effect could be achieved by manually creating files and editing configurations.</p>
</div>
<div class="section" id="creating-the-examplecontroller">
<h3>18.2.1 Creating the ExampleController<a class="headerlink" href="#creating-the-examplecontroller" title="Permalink to this headline">¶</a></h3>
<p>VuFind’s plugin generator can create controllers starting with VuFind 7.0, so this command will establish the ExampleController and configure it to be built using the standard VuFindControllerAbstractBaseFactory:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">php $VUFIND_HOME/public/index.php generate plugin MyModule\\Controller\\ExampleController VuFind\\Controller\\AbstractBaseFactory</span>
</pre></div>
</div>
<p>This command will create a file called $VUFIND_HOME/module/MyModule/src/MyModule/Controller/ExampleController.php. The class will be empty when generated, so you should edit it to add a basic pageAction(), like this:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">&lt;?php</span>

<span class="go">namespace MyModule\Controller;</span>

<span class="go">class ExampleController extends \VuFind\Controller\AbstractBase</span>
<span class="go">{</span>
<span class="go">    /**</span>
<span class="go">         *</span>
<span class="go">         * @return \Laminas\View\Model\ViewModel</span>
<span class="go">            */</span>
<span class="go">             public function pageAction()</span>
<span class="go">                   {</span>
<span class="go">                      return $this-&gt;createViewModel();</span>
<span class="go">                             }</span>
<span class="go">                           }</span>
</pre></div>
</div>
<p>All the pageAction does is return an empty view model, which will simply cause a view template to be rendered. And that leads to the next step</p>
<div class="section" id="create-the-view-template">
<h4>18.2.2 Create the View Template<a class="headerlink" href="#create-the-view-template" title="Permalink to this headline">¶</a></h4>
<p>By convention, the template file displayed by the pageAction of the ExampleController should be named example/page.phtml, so you should create the file $VUFIND_HOME/themes/localtheme/templates/example/page.phtml. You can put any HTML and/or PHP logic in here that you like. For example:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">&lt;p&gt;Hello, world!&lt;/p&gt;</span>
</pre></div>
</div>
<p>At this point, if you add “Example/Page” to your VuFind home URL, you should see “Hello, world!” in your browser. This is because of the default route definition discussed in the previous section. However, there are some advantages to defining a specific route for this action, so there’s one more step to go…</p>
</div>
<div class="section" id="defining-a-route">
<h4>18.2.3 Defining a Route<a class="headerlink" href="#defining-a-route" title="Permalink to this headline">¶</a></h4>
<p>For simple routes like this one, VuFind has a “staticroute” generator you can call:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">php $VUFIND_HOME/public/index.php generate staticroute Example/Page MyModule</span>
</pre></div>
</div>
<p>This will create some route configuration inside MyModule’s config/module.config.php file defining a route named ‘example-page’ which matches an ‘/Example/Page’ URL and routes the user to the pageAction of the ExampleController. The main advantage to this over simply relying on the default route is that it allows you to generate links to your new page by using the URL view helper with the route name. For example, you could edit your $VUFIND_HOME/themes/localtheme/templates/example/page.phtml like this:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">&lt;?php $link = $this-&gt;url(&#39;example-page&#39;); ?&gt;</span>
<span class="go">&lt;p&gt;Hello, world! The link to this page is &lt;a href=&quot;&lt;?=$this-&gt;escapeHtmlAttr($link)?&gt;&quot;&gt;&lt;?=$this-&gt;escapeHtml($link)?&gt;&lt;/a&gt;.&lt;/</span>
</pre></div>
</div>
<p>Obviously, this is a very simplistic example – but by understanding the relationship between routes, controllers and views, you can better understand VuFind’s code and behavior, and more easily extend its functionality to meet your local needs!</p>
</div>
</div>
<div class="section" id="additional-resources">
<h3>Additional Resources<a class="headerlink" href="#additional-resources" title="Permalink to this headline">¶</a></h3>
<p>As noted earlier, the Laminas documentation provides more detail on controllers and routing; see <a class="reference external" href="https://docs.laminas.dev/laminas-mvc/">https://docs.laminas.dev/laminas-mvc/</a> and <a class="reference external" href="https://docs.laminas.dev/laminas-router/">https://docs.laminas.dev/laminas-router/</a> in particular. The VuFind wiki page on controllers also contains some VuFind-specific details and up-to-date examples: <a class="reference external" href="https://vufind.org/wiki/development:plugins:controllers">https://vufind.org/wiki/development:plugins:controllers</a>.</p>
</div>
<div class="section" id="summary">
<h3>Summary<a class="headerlink" href="#summary" title="Permalink to this headline">¶</a></h3>
<p>VuFind leverages the laminas-mvc system for model-view-controller architecture. The laminas-router component helps turn user request URLs into calls to action methods on controller classes. These methods process user input and help turn it into user output, either by generating HTTP responses or by delegating work to the view template system. Controllers are plug-ins, just like many other parts of VuFind, so they can be easily created and extended.</p>
</div>
<div class="section" id="review-questions">
<h3>Review Questions<a class="headerlink" href="#review-questions" title="Permalink to this headline">¶</a></h3>
<ol class="arabic simple">
<li><p>How does the router impact which controller action gets called?</p></li>
<li><p>Why would a controller action return an HTTP response object instead of a view model?</p></li>
<li><p>What class do most VuFind controllers extend from?</p></li>
</ol>
</div>
</div>
</div>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Controllers and actions</a><ul>
<li><a class="reference internal" href="#chapter-18-controllers-and-actions">Chapter 18. Controllers and Actions</a><ul>
<li><a class="reference internal" href="#learning-objectives">Learning Objectives</a></li>
<li><a class="reference internal" href="#example-adding-a-page-to-vufind">18.2 Example: Adding a Page to VuFind</a></li>
<li><a class="reference internal" href="#creating-the-examplecontroller">18.2.1 Creating the ExampleController</a><ul>
<li><a class="reference internal" href="#create-the-view-template">18.2.2 Create the View Template</a></li>
<li><a class="reference internal" href="#defining-a-route">18.2.3 Defining a Route</a></li>
</ul>
</li>
<li><a class="reference internal" href="#additional-resources">Additional Resources</a></li>
<li><a class="reference internal" href="#summary">Summary</a></li>
<li><a class="reference internal" href="#review-questions">Review Questions</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="vufindplugin.html"
                        title="previous chapter">Vufind plugins</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="conf_files.html"
                        title="next chapter">Vufind Configuration options</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/controlers.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="conf_files.html" title="Vufind Configuration options"
             >next</a> |</li>
        <li class="right" >
          <a href="vufindplugin.html" title="Vufind plugins"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">Vufind Documentation 0.0.1 documentation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Controllers and actions</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2020, Demian Katz .
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 3.2.1.
    </div>
  </body>
</html>